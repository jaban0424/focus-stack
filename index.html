<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Focus Stack</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <!-- Babel (JSX ë³€í™˜ìš©) -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- ì•„ì´ì½˜ & ì°¨íŠ¸ ë¼ì´ë¸ŒëŸ¬ë¦¬ ìŠ¤íƒ€ì¼ -->
    <style>
        body { background-color: #f8fafc; }
        .recharts-wrapper { margin: 0 auto; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel" data-type="module">
        // -----------------------------------------------------------
        // âš ï¸ ì—¬ê¸°ì„œë¶€í„° ë³¸ì¸ì˜ í‚¤ë¥¼ ì…ë ¥í•˜ì„¸ìš” âš ï¸
        // -----------------------------------------------------------
        
        // 1. Firebase ì½˜ì†” -> í”„ë¡œì íŠ¸ ì„¤ì • -> ë‚´ ì•± -> SDK ì„¤ì • ë° êµ¬ì„±ì˜ firebaseConfig ë‚´ìš©
        const firebaseConfig = {
            apiKey: "AIzaSyDEJKnKEeDefT1dGfz5kOTOJ0lhQIhK5l8",
            authDomain: "focus-stack.firebaseapp.com",
            projectId: "focus-stack",
            storageBucket: "focus-stack.firebasestorage.app",
            messagingSenderId: "470776560006",
            appId: "1:470776560006:web:a6da75c8b3ef6d3fffd407",
            measurementId: "G-FK9DCT867W"
          };

        // -----------------------------------------------------------
        // ì•„ë˜ ì½”ë“œëŠ” ìˆ˜ì •í•˜ì§€ ì•Šìœ¼ì…”ë„ ë©ë‹ˆë‹¤.
        // -----------------------------------------------------------

        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getAuth, onAuthStateChanged, GoogleAuthProvider, signInWithPopup, signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
        import { getFirestore, collection, addDoc, query, orderBy, onSnapshot, doc, updateDoc, deleteDoc, serverTimestamp, where } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";
        import React, { useState, useEffect, useMemo } from 'https://esm.sh/react@18';
        import ReactDOM from 'https://esm.sh/react-dom@18';
        import { LineChart, Line, XAxis, YAxis, CartesianGrid, Tooltip, ResponsiveContainer, ReferenceLine, Label, ComposedChart } from 'https://esm.sh/recharts@2.10.3';
        import { Plus, Trash2, Edit2, ArrowLeft, CheckCircle, Clock, BookOpen, TrendingUp, Calendar, ToggleLeft, ToggleRight, X, LogOut, User, Shield, Smartphone, ChevronRight, ChevronLeft, Database, HelpCircle, Zap, Layers, MousePointerClick } from 'https://esm.sh/lucide-react@0.294.0';

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        const googleProvider = new GoogleAuthProvider();

        // Helper: Local Storage Manager
        const LOCAL_KEY = 'focus_stack_local_v1';
        const getLocalData = () => {
            const data = localStorage.getItem(LOCAL_KEY);
            return data ? JSON.parse(data) : { subjects: [], stacks: [], timestamps: [] };
        };
        const setLocalData = (data) => localStorage.setItem(LOCAL_KEY, JSON.stringify(data));

        // Regression Helper
        const calculateRegression = (data) => {
            const n = data.length;
            if (n < 2) return null;
            let sumX = 0, sumY = 0, sumXY = 0, sumXX = 0;
            data.forEach(p => {
                sumX += p.totalMinutes;
                sumY += p.page;
                sumXY += (p.totalMinutes * p.page);
                sumXX += (p.totalMinutes * p.totalMinutes);
            });
            const denominator = (n * sumXX - sumX * sumX);
            if (denominator === 0) return null;
            const slope = (n * sumXY - sumX * sumY) / denominator;
            const intercept = (sumY - slope * sumX) / n;
            return {
                slope, intercept,
                predict: (x) => slope * x + intercept,
                predictX: (y) => (y - intercept) / slope
            };
        };

        const formatDateTime = (date) => {
            if (!date) return '';
            return `${date.getMonth()+1}/${date.getDate()} ${date.getHours().toString().padStart(2,'0')}:${date.getMinutes().toString().padStart(2,'0')}`;
        };
        const formatTimeOnly = (date) => {
            if (!date) return '';
            return `${date.getHours().toString().padStart(2,'0')}:${date.getMinutes().toString().padStart(2,'0')}`;
        };
        const isSameDay = (d1, d2) => d1.getFullYear() === d2.getFullYear() && d1.getMonth() === d2.getMonth() && d1.getDate() === d2.getDate();

        // --- COMPONENTS ---

        function TutorialModal({ onClose }) {
            const [step, setStep] = useState(0);
            const steps = [
                {
                    title: "Focus Stackì— ì˜¤ì‹  ê²ƒì„ í™˜ì˜í•©ë‹ˆë‹¤!",
                    icon: <BookOpen size={48} className="text-blue-500 mb-4" />,
                    content: <div className="text-center space-y-2"><p className="font-bold text-lg text-slate-700">"ë‚˜ì˜ ê³µë¶€ë¥¼ ìŒ“ë‹¤"</p><p className="text-slate-500 text-sm leading-relaxed">ê³µë¶€í•˜ëŠ” ë™ì•ˆ í©ì–´ì§€ëŠ” ì§‘ì¤‘ë ¥ì„ ì‹œê°ì ìœ¼ë¡œ ì¡ì•„ë“œë¦½ë‹ˆë‹¤.<br/>í˜ì´ì§€ ì§„ë„ë¥¼ ê·¸ë˜í”„ë¡œ í™•ì¸í•˜ë©°<br/>ëê¹Œì§€ ì™„ì£¼í•  ìˆ˜ ìˆë„ë¡ ë•ëŠ” ëŸ¬ë‹ë©”ì´íŠ¸ì…ë‹ˆë‹¤.</p></div>
                },
                {
                    title: "ì–´ë–»ê²Œ ì‚¬ìš©í•˜ë‚˜ìš”?",
                    icon: <TrendingUp size={48} className="text-orange-500 mb-4" />,
                    content: <div className="w-full space-y-4"><div className="bg-slate-50 p-4 rounded-xl border border-slate-200"><div className="h-24 w-full"><ResponsiveContainer width="100%" height="100%"><LineChart data={[{x:0,y:0}, {x:20,y:10}, {x:40,y:35}, {x:60,y:40}]}><Line type="linear" dataKey="y" stroke="#3b82f6" strokeWidth={3} dot={{r:2}} /></LineChart></ResponsiveContainer></div><p className="text-xs text-center text-slate-400 mt-2">ì…ë ¥í•  ë•Œë§ˆë‹¤ ê·¸ë˜í”„ê°€ ìƒìŠ¹í•´ìš”!</p></div><ul className="text-sm text-slate-600 space-y-2 text-left px-4 list-disc"><li><strong>ìŠ¤íƒ ìƒì„±:</strong> ê³µë¶€ë¥¼ ì‹œì‘í•  ë•Œ '+' ë²„íŠ¼ì„ ëˆ„ë¥´ì„¸ìš”.</li><li><strong>ê¸°ë¡ ì…ë ¥:</strong> '10 í˜ì´ì§€' ì²˜ëŸ¼ ìˆ«ìë§Œ ì…ë ¥í•˜ë©´ ì‹¤ì‹œê°„ìœ¼ë¡œ ê·¸ë˜í”„ê°€ ê·¸ë ¤ì§‘ë‹ˆë‹¤.</li><li><strong>ì™„ë£Œ:</strong> íœ´ì‹í•  ë• 'ì™„ë£Œ'ë¥¼ ëˆŒëŸ¬ ê¸°ë¡ì„ ì €ì¥í•˜ì„¸ìš”.</li></ul></div>
                },
                {
                    title: "ë°ì´í„°ëŠ” ì•ˆì „í•œê°€ìš”?",
                    icon: <Shield size={48} className="text-green-500 mb-4" />,
                    content: <div className="text-center space-y-3"><div className="flex justify-center gap-4 mb-2"><div className="flex flex-col items-center"><Smartphone className="text-slate-400 mb-1" /><span className="text-xs font-bold text-slate-500">ê¸°ë³¸ ëª¨ë“œ</span></div><div className="w-px h-10 bg-slate-200"></div><div className="flex flex-col items-center"><Database className="text-blue-500 mb-1" /><span className="text-xs font-bold text-blue-600">êµ¬ê¸€ ì—°ë™</span></div></div><p className="text-sm text-slate-600 leading-relaxed"><strong>ê¸°ë³¸ì ìœ¼ë¡œ ë°ì´í„°ëŠ” ì´ ê¸°ê¸°ì—ë§Œ ì €ì¥ë©ë‹ˆë‹¤.</strong><br/>ê°œì¸ì •ë³´ ìœ ì¶œ ê±±ì • ì—†ì´ ì•ˆì „í•˜ê²Œ ì‚¬ìš©í•˜ì„¸ìš”.</p><div className="bg-blue-50 p-3 rounded-lg text-xs text-blue-700 text-left">ğŸ’¡ <strong>TIP:</strong> ìƒë‹¨ì˜ 'êµ¬ê¸€ ì—°ë™' ë²„íŠ¼ì„ ëˆ„ë¥´ë©´ Firebase(êµ¬ê¸€ í´ë¼ìš°ë“œ)ì— ì €ì¥ë˜ì–´, PCì™€ ìŠ¤ë§ˆíŠ¸í° ë“± ì—¬ëŸ¬ ê¸°ê¸°ì—ì„œ ì´ì–´ì„œ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</div></div>
                }
            ];
            return (
                <div className="fixed inset-0 bg-black/60 z-50 flex items-center justify-center p-4 animate-in fade-in">
                    <div className="bg-white rounded-2xl w-full max-w-sm shadow-2xl overflow-hidden flex flex-col min-h-[400px]">
                        <div className="p-4 flex justify-end"><button onClick={onClose} className="text-slate-300 hover:text-slate-500"><X size={24} /></button></div>
                        <div className="flex-1 px-8 flex flex-col items-center pt-2 pb-8">{steps[step].icon}<h2 className="text-xl font-bold text-slate-800 mb-6">{steps[step].title}</h2>{steps[step].content}</div>
                        <div className="p-6 border-t border-slate-100 flex justify-between items-center bg-slate-50"><div className="flex gap-1">{steps.map((_, i) => <div key={i} className={`w-2 h-2 rounded-full transition-all ${i === step ? 'bg-blue-500 w-4' : 'bg-slate-300'}`} />)}</div><div className="flex gap-2">{step > 0 && <button onClick={() => setStep(s => s - 1)} className="p-2 rounded-full hover:bg-slate-200 text-slate-500"><ChevronLeft size={20} /></button>}{step < steps.length - 1 ? <button onClick={() => setStep(s => s + 1)} className="flex items-center gap-1 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 font-bold text-sm">ë‹¤ìŒ <ChevronRight size={16} /></button> : <button onClick={onClose} className="flex items-center gap-1 px-6 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 font-bold text-sm">ì‹œì‘í•˜ê¸° <CheckCircle size={16} /></button>}</div></div>
                    </div>
                </div>
            );
        }

        function SubjectHelpModal({ onClose }) {
            const steps = [
                { title: "â° ê·€ì°®ì€ ì‹œê°„ ì…ë ¥ì€ ê·¸ë§Œ!", icon: <Zap size={32} className="text-yellow-500" />, desc: "ì‹¤ì‹œê°„ ëª¨ë“œê°€ ê¸°ë³¸ì…ë‹ˆë‹¤. í˜„ì¬ ì‹œê°„ì„ ìë™ìœ¼ë¡œ ì½ì–´ì˜¤ë‹ˆ, í•˜ë‹¨ ì…ë ¥ì°½ì— 'í˜ì´ì§€ ë²ˆí˜¸'ë§Œ ì…ë ¥í•˜ê³  ì—”í„°ë¥¼ ì¹˜ì„¸ìš”." },
                { title: "ğŸ“‰ ë‚˜ì˜ ê³µë¶€ë¥¼ ì‹œê°í™”", icon: <TrendingUp size={32} className="text-blue-500" />, desc: "ì…ë ¥í•œ í˜ì´ì§€ëŠ” ìë™ìœ¼ë¡œ ì‹œê³„ì—´ ê·¸ë˜í”„ë¡œ ë³€í™˜ë©ë‹ˆë‹¤. ë‚´ê°€ ì–¼ë§ˆë‚˜ ì§‘ì¤‘í–ˆëŠ”ì§€ í•œëˆˆì— ë³¼ ìˆ˜ ìˆì–´ìš”." },
                { title: "ğŸ“š ìŠ¤íƒ(Stack)ì´ë€?", icon: <Layers size={32} className="text-purple-500" />, desc: "í•œ ë²ˆì˜ ì—°ì†ëœ ê³µë¶€ ì„¸ì…˜ì…ë‹ˆë‹¤. í™”ì¥ì‹¤ì„ ê°€ê±°ë‚˜ íœ´ì‹ì„ ì·¨í•  ë• ìŠ¤íƒì„ 'ì™„ë£Œ'í•˜ê³ , ëŒì•„ì™€ì„œ 'ìƒˆ ìŠ¤íƒ'ì„ ë§Œë“œì„¸ìš”. ìˆœê³µ ì‹œê°„ë§Œ ê¹”ë”í•˜ê²Œ ì´ì–´ ë¶™ì—¬ ë³´ì—¬ì¤ë‹ˆë‹¤." },
                { title: "âœï¸ ì–¸ì œë“  ìˆ˜ì • ê°€ëŠ¥", icon: <MousePointerClick size={32} className="text-slate-500" />, desc: "ì‹¤ìˆ˜ë¡œ ì˜ëª» ì…ë ¥í–ˆë‚˜ìš”? ìš°ì¸¡ ìŠ¤íƒ ëª©ë¡ì—ì„œ 'ìˆ˜ì •' ë²„íŠ¼ì„ ëˆŒëŸ¬ ê¸°ë¡ì„ ê³ ì¹˜ê±°ë‚˜ ì‚­ì œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤." }
            ];
            return (
                <div className="fixed inset-0 bg-black/60 z-50 flex items-center justify-center p-4 animate-in fade-in">
                    <div className="bg-white rounded-2xl w-full max-w-sm shadow-2xl p-6 relative">
                        <button onClick={onClose} className="absolute top-4 right-4 text-slate-300 hover:text-slate-500"><X size={24} /></button>
                        <h2 className="text-xl font-bold text-slate-800 mb-6 flex items-center gap-2"><HelpCircle className="text-blue-500"/> ì‚¬ìš© ê°€ì´ë“œ</h2>
                        <div className="space-y-6">{steps.map((s, i) => <div key={i} className="flex gap-4"><div className="shrink-0 mt-1">{s.icon}</div><div><h3 className="font-bold text-slate-800 mb-1">{s.title}</h3><p className="text-xs text-slate-500 leading-relaxed">{s.desc}</p></div></div>)}</div>
                        <button onClick={onClose} className="w-full mt-8 py-3 bg-slate-800 text-white rounded-xl font-bold hover:bg-slate-900">í™•ì¸í–ˆìŠµë‹ˆë‹¤</button>
                    </div>
                </div>
            );
        }

        // --- MAIN APP ---
        function App() {
            const [user, setUser] = useState(null);
            const [currentView, setCurrentView] = useState('home');
            const [selectedSubjectId, setSelectedSubjectId] = useState(null);
            const [showTutorial, setShowTutorial] = useState(false);

            useEffect(() => {
                const unsubscribe = onAuthStateChanged(auth, (currentUser) => setUser(currentUser));
                const hasSeen = localStorage.getItem('hasSeenTutorial_v2');
                if (!hasSeen) setShowTutorial(true);
                return () => unsubscribe();
            }, []);

            const closeTutorial = () => {
                localStorage.setItem('hasSeenTutorial_v2', 'true');
                setShowTutorial(false);
            };

            const handleLogin = async () => {
                try {
                    if (window.confirm("êµ¬ê¸€ ê³„ì •ê³¼ ì—°ë™í•˜ì‹œê² ìŠµë‹ˆê¹Œ?\nì—°ë™ í›„ì—ëŠ” ë¡œì»¬ ë°ì´í„° ëŒ€ì‹  í´ë¼ìš°ë“œ ë°ì´í„°ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.")) {
                        await signInWithPopup(auth, googleProvider);
                    }
                } catch (error) {
                    console.error("Login Failed:", error);
                    alert("ë¡œê·¸ì¸ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.");
                }
            };

            const handleLogout = () => {
                if (window.confirm("ë¡œê·¸ì•„ì›ƒ í•˜ì‹œê² ìŠµë‹ˆê¹Œ? ë‹¤ì‹œ ë¡œì»¬ ëª¨ë“œë¡œ ì „í™˜ë©ë‹ˆë‹¤.")) {
                    signOut(auth);
                    setSelectedSubjectId(null);
                    setCurrentView('home');
                }
            };

            return (
                <div className="min-h-screen bg-slate-50 font-sans text-slate-800">
                    {showTutorial && <TutorialModal onClose={closeTutorial} />}
                    {currentView === 'home' ? 
                        <HomeScreen user={user} onSelectSubject={(id) => { setSelectedSubjectId(id); setCurrentView('subject'); }} onLogin={handleLogin} onLogout={handleLogout} /> 
                        : <SubjectDetailScreen user={user} subjectId={selectedSubjectId} onBack={() => { setSelectedSubjectId(null); setCurrentView('home'); }} />
                    }
                </div>
            );
        }

        function HomeScreen({ user, onSelectSubject, onLogin, onLogout }) {
            const [subjects, setSubjects] = useState([]);
            const [isModalOpen, setIsModalOpen] = useState(false);
            const [newSubjectName, setNewSubjectName] = useState('');
            const [startPage, setStartPage] = useState('0');
            const [totalPages, setTotalPages] = useState('');
            const [milestones, setMilestones] = useState('');

            useEffect(() => {
                if (user) {
                    const q = query(collection(db, 'users', user.uid, 'subjects'), orderBy('createdAt', 'desc'));
                    const unsub = onSnapshot(q, (snapshot) => {
                        setSubjects(snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() })));
                    });
                    return () => unsub();
                } else {
                    const localData = getLocalData();
                    setSubjects(localData.subjects.sort((a,b) => b.createdAt - a.createdAt));
                }
            }, [user]);

            const handleAdd = async () => {
                if (!newSubjectName || !totalPages) return;
                const parsedMilestones = milestones.split(',').map(m => {
                    const parts = m.trim().split(' ');
                    const page = parseInt(parts.pop());
                    const label = parts.join(' ');
                    return (page && label) ? { label, page } : null;
                }).filter(Boolean);

                const newSubject = { name: newSubjectName, startPage: parseInt(startPage) || 0, totalPages: parseInt(totalPages), milestones: parsedMilestones, createdAt: user ? serverTimestamp() : Date.now() };
                if (user) {
                    await addDoc(collection(db, 'users', user.uid, 'subjects'), newSubject);
                } else {
                    const local = getLocalData();
                    const subjectWithId = { ...newSubject, id: Date.now().toString() };
                    local.subjects.push(subjectWithId);
                    setLocalData(local);
                    setSubjects(prev => [subjectWithId, ...prev]);
                }
                setIsModalOpen(false); setNewSubjectName(''); setStartPage('0'); setTotalPages(''); setMilestones('');
            };

            const handleDelete = async (e, id) => {
                e.stopPropagation();
                if (!window.confirm("ì •ë§ ì´ ê³¼ëª©ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ? ëª¨ë“  ê¸°ë¡ì´ ì‚¬ë¼ì§‘ë‹ˆë‹¤.")) return;
                if (user) { await deleteDoc(doc(db, 'users', user.uid, 'subjects', id)); }
                else {
                    const local = getLocalData();
                    local.subjects = local.subjects.filter(s => s.id !== id);
                    local.stacks = local.stacks.filter(s => s.subjectId !== id);
                    setLocalData(local);
                    setSubjects(prev => prev.filter(s => s.id !== id));
                }
            };

            return (
                <div className="p-8 max-w-4xl mx-auto">
                    <div className="flex justify-between items-center mb-8 bg-white p-4 rounded-xl border border-slate-100 shadow-sm">
                        <div><h1 className="text-2xl font-bold text-slate-800 flex items-center gap-2"><div className="w-8 h-8 bg-blue-600 rounded-lg flex items-center justify-center text-white"><BookOpen size={18} /></div>Focus Stack</h1><p className="text-xs text-slate-400 mt-1 pl-1">{user ? `Cloud Mode (${user.email})` : 'Local Mode (ë‚´ ê¸°ê¸°ì—ë§Œ ì €ì¥)'}</p></div>
                        {user ? <button onClick={onLogout} className="text-xs flex items-center gap-1 px-3 py-1.5 bg-slate-100 hover:bg-slate-200 text-slate-600 rounded-full transition"><LogOut size={14} /> ë¡œê·¸ì•„ì›ƒ</button> : <button onClick={onLogin} className="text-xs flex items-center gap-1 px-3 py-1.5 bg-blue-50 hover:bg-blue-100 text-blue-600 font-bold rounded-full transition border border-blue-200"><Database size={14} /> êµ¬ê¸€ ì—°ë™</button>}
                    </div>
                    <div className="grid grid-cols-1 md:grid-cols-3 gap-6">
                        {subjects.map(subject => (
                            <div key={subject.id} onClick={() => onSelectSubject(subject.id)} className="bg-white p-6 rounded-xl shadow-sm border border-slate-200 hover:shadow-md transition cursor-pointer flex flex-col justify-between h-48 group relative overflow-hidden">
                                <div className="absolute top-0 right-0 p-8 opacity-5"><BookOpen size={100} /></div>
                                <button onClick={(e) => handleDelete(e, subject.id)} className="absolute top-4 right-4 text-slate-300 hover:text-red-500 transition z-10"><Trash2 size={16} /></button>
                                <div><h3 className="text-xl font-bold mb-2 text-slate-800 group-hover:text-blue-600 transition truncate">{subject.name}</h3><p className="text-slate-500 text-sm font-mono">{subject.startPage || 0}p <span className="text-slate-300">/</span> {subject.totalPages}p</p></div>
                                <div className="flex justify-end"><span className="bg-slate-100 text-slate-600 px-3 py-1 rounded-full text-xs font-medium group-hover:bg-blue-100 group-hover:text-blue-600 transition">ì…ì¥í•˜ê¸°</span></div>
                            </div>
                        ))}
                        <button onClick={() => setIsModalOpen(true)} className="h-48 rounded-xl border-2 border-dashed border-slate-300 flex flex-col items-center justify-center text-slate-400 hover:border-blue-400 hover:text-blue-500 hover:bg-blue-50 transition"><Plus size={32} className="mb-2" /><span>ìƒˆ ê³¼ëª© ì¶”ê°€</span></button>
                    </div>
                    {isModalOpen && (
                        <div className="fixed inset-0 bg-black/50 flex items-center justify-center p-4 z-50">
                            <div className="bg-white rounded-2xl p-6 w-full max-w-md shadow-2xl">
                                <h2 className="text-xl font-bold mb-4">ìƒˆ ê³¼ëª© ì„¤ì •</h2>
                                <div className="space-y-4">
                                    <input className="w-full p-3 border rounded-lg" placeholder="ê³¼ëª©ëª… (ì˜ˆ: ì „ê¸°ê¸°ê¸°2)" value={newSubjectName} onChange={e => setNewSubjectName(e.target.value)} />
                                    <div className="flex gap-4"><div className="flex-1"><label className="text-xs font-bold text-slate-500 block mb-1">ì‹œì‘ í˜ì´ì§€</label><input type="number" className="w-full p-3 border rounded-lg" placeholder="0" value={startPage} onChange={e => setStartPage(e.target.value)} /></div><div className="flex-1"><label className="text-xs font-bold text-slate-500 block mb-1">ëª©í‘œ í˜ì´ì§€</label><input type="number" className="w-full p-3 border rounded-lg" placeholder="300" value={totalPages} onChange={e => setTotalPages(e.target.value)} /></div></div>
                                    <div><div className="flex justify-between mb-1"><span className="text-xs font-bold text-slate-500">ì¤‘ê°„ ëª©í‘œ (ì„ íƒ)</span></div><input className="w-full p-3 border rounded-lg" placeholder="Ch1 50, Ch2 100" value={milestones} onChange={e => setMilestones(e.target.value)} /></div>
                                </div>
                                <div className="flex justify-end gap-2 mt-6"><button onClick={() => setIsModalOpen(false)} className="px-4 py-2 text-slate-500">ì·¨ì†Œ</button><button onClick={handleAdd} className="px-4 py-2 bg-blue-600 text-white rounded-lg">ì¶”ê°€</button></div>
                            </div>
                        </div>
                    )}
                </div>
            );
        }

        function SubjectDetailScreen({ user, subjectId, onBack }) {
            const [subject, setSubject] = useState(null);
            const [stacks, setStacks] = useState([]);
            const [activeStackId, setActiveStackId] = useState(null);
            const [allTimestamps, setAllTimestamps] = useState({});
            const [isStackModalOpen, setIsStackModalOpen] = useState(false);
            const [newStackDate, setNewStackDate] = useState(new Date().toISOString().split('T')[0]);
            const [newStackStartTime, setNewStackStartTime] = useState('');
            const [showSubjectHelp, setShowSubjectHelp] = useState(false);
            const [currentDate, setCurrentDate] = useState(new Date());
            const [useCurrentTime, setUseCurrentTime] = useState(true);
            const [inputString, setInputString] = useState('');
            const [editingStackId, setEditingStackId] = useState(null);
            const [editAddPage, setEditAddPage] = useState('');
            const [editAddTime, setEditAddTime] = useState('');

            useEffect(() => {
                const seen = localStorage.getItem('hasSeenSubjectHelp_v1');
                if (!seen) { setShowSubjectHelp(true); localStorage.setItem('hasSeenSubjectHelp_v1', 'true'); }
                if (user) {
                    const unsubSub = onSnapshot(doc(db, 'users', user.uid, 'subjects', subjectId), (d) => setSubject(d.data()));
                    const qStack = query(collection(db, 'users', user.uid, 'subjects', subjectId, 'stacks'), orderBy('startTime', 'asc'));
                    const unsubStack = onSnapshot(qStack, (snapshot) => {
                        const list = snapshot.docs.map(d => ({ id: d.id, ...d.data(), startTime: d.data().startTime?.toDate(), endTime: d.data().endTime?.toDate() }));
                        setStacks(list);
                        const active = list.find(s => !s.isCompleted);
                        if (active) setActiveStackId(active.id);
                    });
                    return () => { unsubSub(); unsubStack(); };
                } else {
                    const local = getLocalData();
                    const subj = local.subjects.find(s => s.id === subjectId);
                    setSubject(subj);
                    const stks = local.stacks.filter(s => s.subjectId === subjectId).map(s => ({ ...s, startTime: new Date(s.startTime), endTime: s.endTime ? new Date(s.endTime) : null })).sort((a,b) => a.startTime - b.startTime);
                    setStacks(stks);
                    const active = stks.find(s => !s.isCompleted);
                    if (active) setActiveStackId(active.id);
                    const tsMap = {};
                    stks.forEach(stack => { const ts = local.timestamps.filter(t => t.stackId === stack.id).map(t => ({...t, recordedAt: new Date(t.recordedAt)})); tsMap[stack.id] = ts; });
                    setAllTimestamps(tsMap);
                }
            }, [user, subjectId]);

            useEffect(() => {
                if (!user || stacks.length === 0) return;
                const unsubs = stacks.map(stack => {
                    const q = query(collection(db, 'users', user.uid, 'subjects', subjectId, 'stacks', stack.id, 'timestamps'), orderBy('recordedAt', 'asc'));
                    return onSnapshot(q, (snap) => {
                        const ts = snap.docs.map(d => ({ id: d.id, ...d.data(), recordedAt: d.data().recordedAt?.toDate(), page: Number(d.data().page) }));
                        setAllTimestamps(prev => ({ ...prev, [stack.id]: ts }));
                    });
                });
                return () => unsubs.forEach(u => u());
            }, [user, subjectId, stacks.length]);

            const initiateCreateStack = async () => { if (useCurrentTime) { await createStackImpl(new Date()); } else { setNewStackDate(new Date().toISOString().split('T')[0]); setNewStackStartTime(''); setIsStackModalOpen(true); } };
            const handleCreateStackManual = async () => { if (!newStackStartTime || !newStackDate) { alert("ë‚ ì§œì™€ ì‹œê°„ì„ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”."); return; } const [h, m] = newStackStartTime.split(':'); const startDt = new Date(newStackDate); startDt.setHours(parseInt(h), parseInt(m), 0); await createStackImpl(startDt); setIsStackModalOpen(false); };
            const createStackImpl = async (startDt) => {
                const newStack = { startTime: startDt, isCompleted: false, dateLabel: startDt.toLocaleDateString() };
                if (user) { await addDoc(collection(db, 'users', user.uid, 'subjects', subjectId, 'stacks'), newStack); }
                else { const local = getLocalData(); const stackId = Date.now().toString(); const stackWithId = { ...newStack, id: stackId, subjectId }; stackWithId.startTime = stackWithId.startTime.toISOString(); local.stacks.push(stackWithId); setLocalData(local); setStacks(prev => [...prev, { ...newStack, id: stackId, startTime: startDt }]); setActiveStackId(stackId); }
            };
            const deleteStack = async (stackId) => {
                const ts = allTimestamps[stackId] || [];
                if (ts.length > 0) { alert("ë°ì´í„°ê°€ ìˆëŠ” ìŠ¤íƒì€ ì‚­ì œí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.\nìˆ˜ì • ë²„íŠ¼ì„ ëˆŒëŸ¬ ëª¨ë“  íƒ€ì„ìŠ¤íƒ¬í”„ë¥¼ ì‚­ì œí•œ í›„ ì‹œë„í•´ì£¼ì„¸ìš”."); return; }
                if (window.confirm("ë¹ˆ ìŠ¤íƒì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) {
                    if (user) { await deleteDoc(doc(db, 'users', user.uid, 'subjects', subjectId, 'stacks', stackId)); }
                    else { const local = getLocalData(); local.stacks = local.stacks.filter(s => s.id !== stackId); setLocalData(local); setStacks(prev => prev.filter(s => s.id !== stackId)); }
                    if (activeStackId === stackId) setActiveStackId(null); if (editingStackId === stackId) setEditingStackId(null);
                }
            };
            const completeStack = async () => {
                if (!activeStackId) return;
                const tsList = allTimestamps[activeStackId] || [];
                let finishTime = new Date();
                if (tsList.length > 0) {
                    const sorted = [...tsList].sort((a,b) => a.recordedAt - b.recordedAt);
                    const lastTs = sorted[sorted.length-1];
                    finishTime = lastTs.recordedAt;
                }
                if (user) { await updateDoc(doc(db, 'users', user.uid, 'subjects', subjectId, 'stacks', activeStackId), { isCompleted: true, endTime: finishTime }); }
                else { const local = getLocalData(); const stackIdx = local.stacks.findIndex(s => s.id === activeStackId); if (stackIdx !== -1) { local.stacks[stackIdx].isCompleted = true; local.stacks[stackIdx].endTime = finishTime.toISOString(); setLocalData(local); setStacks(prev => prev.map(s => s.id === activeStackId ? {...s, isCompleted: true, endTime: finishTime} : s)); } }
                setActiveStackId(null);
            };
            const handleAddTimestamp = async (targetStackId, rawInput, isManualAdd = false) => {
                let hours, minutes, page; const now = new Date();
                if (isManualAdd) { if (!editAddTime || !editAddPage) return; [hours, minutes] = editAddTime.split(':').map(Number); page = parseInt(editAddPage); }
                else if (useCurrentTime) { page = parseInt(rawInput); hours = now.getHours(); minutes = now.getMinutes(); }
                else { const clean = rawInput.replace(':', ''); const match = clean.match(/^(\d{4})\s+(\d+)$/); if (!match) { alert("í˜•ì‹ ì˜¤ë¥˜"); return; } hours = parseInt(match[1].substring(0, 2)); minutes = parseInt(match[1].substring(2, 4)); page = parseInt(match[2]); }
                if (isNaN(page)) return;
                const recordDate = new Date(currentDate); recordDate.setHours(hours, minutes, 0); const newTs = { recordedAt: recordDate, page: page };
                if (user) { await addDoc(collection(db, 'users', user.uid, 'subjects', subjectId, 'stacks', targetStackId, 'timestamps'), newTs); }
                else { const local = getLocalData(); const tsWithId = { ...newTs, id: Date.now().toString(), stackId: targetStackId }; tsWithId.recordedAt = tsWithId.recordedAt.toISOString(); local.timestamps.push(tsWithId); setLocalData(local); setAllTimestamps(prev => { const stackTs = prev[targetStackId] || []; return { ...prev, [targetStackId]: [...stackTs, { ...newTs, id: tsWithId.id }] }; }); }
                setInputString(''); setEditAddPage(''); setEditAddTime('');
            };
            const deleteTimestampLocal = (stackId, tsId) => { const local = getLocalData(); local.timestamps = local.timestamps.filter(t => t.id !== tsId); setLocalData(local); setAllTimestamps(prev => { const stackTs = prev[stackId] || []; return { ...prev, [stackId]: stackTs.filter(t => t.id !== tsId) }; }); };
            const deleteTimestampCloud = async (stackId, tsId) => { await deleteDoc(doc(db, 'users', user.uid, 'subjects', subjectId, 'stacks', stackId, 'timestamps', tsId)); };

            const { graphData, regressionLine, maxXDomain, predictionInfo } = useMemo(() => {
                let data = []; let totalAccumulatedMinutes = 0; const sortedStacks = [...stacks].sort((a,b) => a.startTime - b.startTime);
                sortedStacks.forEach(stack => {
                    const ts = allTimestamps[stack.id] || []; if (ts.length === 0) return;
                    const sortedTs = [...ts].sort((a,b) => a.recordedAt - b.recordedAt); const stackStartTime = stack.startTime;
                    sortedTs.forEach(p => { const durationInStack = Math.floor((p.recordedAt - stackStartTime) / 60000); const validDuration = Math.max(0, durationInStack); data.push({ totalMinutes: totalAccumulatedMinutes + validDuration, page: p.page, stackId: stack.id, realTime: p.recordedAt }); });
                    const lastPoint = sortedTs[sortedTs.length-1]; const stackDuration = Math.floor((lastPoint.recordedAt - stackStartTime) / 60000); totalAccumulatedMinutes += Math.max(0, stackDuration);
                });
                let regLine = null; let maxDomain = 'auto'; let predInfo = null;
                if (data.length >= 2 && subject) {
                    const reg = calculateRegression(data);
                    if (reg && reg.slope > 0) {
                        const targetX = reg.predictX(subject.totalPages); const lastDataPoint = data[data.length-1]; const remainingPages = subject.totalPages - lastDataPoint.page; const remainingMinutes = remainingPages / reg.slope;
                        const predictedFinishDate = new Date(lastDataPoint.realTime.getTime() + remainingMinutes * 60000);
                        predInfo = { remainingTimeStr: `${Math.floor(remainingMinutes/60)}ì‹œê°„ ${Math.round(remainingMinutes%60)}ë¶„`, predictedClockTime: formatDateTime(predictedFinishDate) };
                        const currentMaxX = lastDataPoint.totalMinutes; const clampedTargetX = Math.min(targetX, Math.max(currentMaxX * 2, 60));
                        regLine = [ { totalMinutes: lastDataPoint.totalMinutes, page: reg.predict(lastDataPoint.totalMinutes) }, { totalMinutes: targetX, page: subject.totalPages } ]; maxDomain = clampedTargetX;
                    }
                }
                return { graphData: data, regressionLine: regLine, maxXDomain: maxDomain, predictionInfo: predInfo };
            }, [stacks, allTimestamps, subject]);

            return (
                <div className="flex flex-col h-screen overflow-hidden bg-slate-50">
                    {showSubjectHelp && <SubjectHelpModal onClose={() => setShowSubjectHelp(false)} />}
                    <header className="bg-white border-b px-4 py-3 flex justify-between items-center shadow-sm shrink-0 z-20">
                        <div className="flex items-center gap-3"><button onClick={onBack} className="p-2 hover:bg-slate-100 rounded-full text-slate-500"><ArrowLeft size={20}/></button><div><h1 className="font-bold text-slate-800 text-lg">{subject?.name}</h1><div className="text-xs text-slate-500">{subject?.startPage}p ~ {subject?.totalPages}p ëª©í‘œ</div></div></div>
                        <div className="flex items-center bg-slate-100 rounded-lg p-1 gap-2"><button onClick={() => setUseCurrentTime(!useCurrentTime)} className={`flex items-center gap-2 px-3 py-1.5 rounded-md text-xs font-bold transition ${useCurrentTime ? 'bg-white text-blue-600 shadow-sm' : 'text-slate-400'}`}>{useCurrentTime ? <ToggleRight size={16}/> : <ToggleLeft size={16}/>}{useCurrentTime ? 'â° ì‹¤ì‹œê°„' : 'âŒ¨ï¸ ìˆ˜ê¸°ì…ë ¥'}</button><button onClick={() => setShowSubjectHelp(true)} className="p-2 text-slate-400 hover:text-blue-600 transition"><HelpCircle size={18} /></button></div>
                    </header>
                    <main className="flex-1 flex overflow-hidden">
                        <div className="flex-1 flex flex-col p-4 min-w-0">
                            <div className="flex-1 bg-white rounded-2xl border shadow-sm p-4 relative overflow-hidden">
                                <div className="absolute top-2 right-6 z-10 pointer-events-none space-y-1 flex flex-col items-end"><h2 className="text-lg font-bold text-slate-400">ì§„ë„ íë¦„ & ì˜ˆì¸¡</h2>{predictionInfo && (<div className="flex flex-col items-end gap-1"><div className="flex items-center gap-2 text-xs text-orange-600 font-bold bg-orange-50 px-2 py-1 rounded shadow-sm border border-orange-100"><TrendingUp size={12}/> ì”ì—¬: {predictionInfo.remainingTimeStr}</div><div className="flex items-center gap-2 text-xs text-blue-600 font-bold bg-blue-50 px-2 py-1 rounded shadow-sm border border-blue-100"><Clock size={12}/> ì˜ˆìƒì™„ì£¼: {predictionInfo.predictedClockTime}</div></div>)}</div>
                                <ResponsiveContainer width="100%" height="100%"><ComposedChart data={graphData} margin={{ top: 80, right: 30, left: 10, bottom: 20 }}><CartesianGrid strokeDasharray="3 3" vertical={false} stroke="#f1f5f9" /><XAxis dataKey="totalMinutes" type="number" domain={[0, maxXDomain]} tickFormatter={m => `${Math.floor(m/60)}h`} stroke="#94a3b8" fontSize={12} allowDuplicatedCategory={false} /><YAxis width={40} domain={[subject?.startPage || 0, subject?.totalPages || 'auto']} stroke="#94a3b8" fontSize={12} /><Tooltip cursor={{ stroke: '#3b82f6', strokeWidth: 1, strokeDasharray: '4 4' }} contentStyle={{ borderRadius: '8px', border: 'none', boxShadow: '0 4px 12px rgba(0,0,0,0.1)' }} labelFormatter={m => `ëˆ„ì  ${Math.floor(m/60)}ì‹œê°„ ${m%60}ë¶„`} />{subject?.milestones?.map((ms, idx) => (<ReferenceLine key={idx} y={ms.page} stroke="#cbd5e1" strokeDasharray="3 3"><Label value={ms.label} position="insideTopRight" fill="#94a3b8" fontSize={11} /></ReferenceLine>))}{regressionLine && (<Line dataKey="page" data={regressionLine} stroke="#fb923c" strokeWidth={2} strokeDasharray="5 5" dot={false} isAnimationActive={false} />)}<Line type="linear" dataKey="page" stroke="#3b82f6" strokeWidth={3} dot={{ r: 3, fill: "#3b82f6", strokeWidth: 0 }} isAnimationActive={false} /></ComposedChart></ResponsiveContainer>
                            </div>
                            <div className="mt-4 h-20 bg-white rounded-xl border shadow-sm flex items-center px-4 gap-3 shrink-0">
                                <div className="flex flex-col items-center bg-slate-50 px-2 py-1 rounded border border-slate-100"><button onClick={() => {const d=new Date(currentDate);d.setDate(d.getDate()+1);setCurrentDate(d)}} className="text-slate-400 text-[10px]">â–²</button><div className="font-mono font-bold text-slate-700 text-sm whitespace-nowrap">{currentDate.toLocaleDateString(undefined, {month:'numeric', day:'numeric'})}</div><button onClick={() => {const d=new Date(currentDate);d.setDate(d.getDate()-1);setCurrentDate(d)}} className="text-slate-400 text-[10px]">â–¼</button></div>
                                <div className="flex-1 relative"><input type="text" className={`w-full h-12 rounded-lg px-4 font-mono text-lg transition focus:ring-2 focus:ring-blue-500 outline-none ${!activeStackId ? 'bg-slate-50 text-slate-400 cursor-not-allowed' : useCurrentTime ? 'bg-blue-50 text-blue-900' : 'bg-slate-100 text-slate-800'}`} placeholder={!activeStackId ? "ì§„í–‰ ì¤‘ì¸ ìŠ¤íƒì´ ì—†ìŠµë‹ˆë‹¤" : (useCurrentTime ? "í˜„ì¬ í˜ì´ì§€ ì…ë ¥ (ì˜ˆ: 130)" : "00:00 000 (ì‹œê° í˜ì´ì§€)")} value={inputString} onChange={e => setInputString(e.target.value)} disabled={!activeStackId} onKeyDown={e => e.key === 'Enter' && handleAddTimestamp(activeStackId, inputString)} /></div>
                                {activeStackId ? (<><button onClick={() => handleAddTimestamp(activeStackId, inputString)} className="bg-blue-600 hover:bg-blue-700 text-white font-bold h-12 px-6 rounded-lg shadow-sm whitespace-nowrap">ì¶”ê°€</button><button onClick={completeStack} className="bg-slate-800 hover:bg-slate-900 text-white h-12 px-4 rounded-lg flex items-center gap-2 whitespace-nowrap"><CheckCircle size={18}/> <span className="hidden sm:inline">ì™„ë£Œ</span></button></>) : (<div className="text-sm text-slate-400 font-medium px-2 whitespace-nowrap">ìš°ì¸¡ì—ì„œ ì‹œì‘</div>)}
                            </div>
                        </div>
                        <div className="w-80 bg-white border-l flex flex-col shrink-0">
                            <div className="flex-1 overflow-y-auto p-4 border-b">
                                <h3 className="text-xs font-bold text-slate-400 uppercase mb-3">Study Stacks</h3>
                                {!activeStackId && (<button onClick={initiateCreateStack} className="w-full py-3 mb-4 border-2 border-dashed border-blue-300 rounded-xl text-blue-500 hover:bg-blue-50 font-bold flex items-center justify-center gap-2"><Plus size={18}/> {useCurrentTime ? 'ë°”ë¡œ ì‹œì‘' : 'ìƒˆ ìŠ¤íƒ ë§Œë“¤ê¸°'}</button>)}
                                <div className="space-y-3">{stacks.map(stack => { const ts = allTimestamps[stack.id] || []; const sortedTs = [...ts].sort((a,b) => a.recordedAt - b.recordedAt); let rangeStr = formatDateTime(stack.startTime); if (stack.isCompleted && stack.endTime) { const endStr = isSameDay(stack.startTime, stack.endTime) ? formatTimeOnly(stack.endTime) : formatDateTime(stack.endTime); rangeStr += ` ~ ${endStr}`; } else if (sortedTs.length > 0) { rangeStr += ' ~ ...'; } const lastPage = sortedTs.length > 0 ? sortedTs[sortedTs.length-1].page : '-'; return (<div key={stack.id} className={`p-3 rounded-xl border relative group ${activeStackId===stack.id ? 'bg-blue-50 border-blue-200' : editingStackId===stack.id ? 'bg-indigo-50 border-indigo-200' : 'bg-white border-slate-100'}`}><button onClick={(e) => { e.stopPropagation(); deleteStack(stack.id); }} className="absolute top-2 right-2 text-slate-300 hover:text-red-500 hidden group-hover:block"><X size={14} /></button><div className="flex justify-between items-center mb-1 pr-6"><span className="text-xs font-bold text-slate-600 flex items-center gap-1"><Calendar size={10}/> {stack.dateLabel}</span>{stack.isCompleted ? (<button onClick={() => setEditingStackId(prev => prev===stack.id ? null : stack.id)} className="text-[10px] bg-white border px-2 py-0.5 rounded text-slate-500 hover:text-indigo-600">{editingStackId===stack.id ? 'ë‹«ê¸°' : 'ìˆ˜ì •'}</button>) : (<span className="text-[10px] bg-blue-100 text-blue-600 px-2 py-0.5 rounded font-bold animate-pulse">ì§„í–‰ ì¤‘</span>)}</div><div className="font-bold text-slate-800 text-sm whitespace-nowrap overflow-hidden text-ellipsis">{rangeStr}</div><div className="text-xs text-slate-400 mt-1">{ts.length} points Â· {lastPage}p ë„ë‹¬</div></div>) })}</div>
                            </div>
                            {(editingStackId || activeStackId) && (
                                <div className="h-2/5 flex flex-col bg-slate-50">
                                    <div className="p-2 border-b bg-white font-bold text-xs text-slate-500 flex justify-between items-center px-4"><span className="flex items-center gap-1"><Edit2 size={12}/> íƒ€ì„ìŠ¤íƒ¬í”„ í¸ì§‘</span></div>
                                    {editingStackId && (<div className="p-2 bg-indigo-50 border-b border-indigo-100 flex gap-2"><input className="w-16 p-1 text-center text-sm border rounded" placeholder="14:00" value={editAddTime} onChange={e => setEditAddTime(e.target.value)} /><input className="flex-1 p-1 text-center text-sm border rounded" placeholder="í˜ì´ì§€" type="number" value={editAddPage} onChange={e => setEditAddPage(e.target.value)} /><button onClick={() => handleAddTimestamp(editingStackId, null, true)} className="bg-indigo-600 text-white px-3 rounded text-xs font-bold">ì¶”ê°€</button></div>)}
                                    <div className="flex-1 overflow-y-auto p-2 space-y-1">{(editingStackId ? allTimestamps[editingStackId] : allTimestamps[activeStackId])?.sort((a,b)=>b.recordedAt-a.recordedAt).map(t => (<div key={t.id} className="flex justify-between items-center p-2 bg-white rounded border text-sm group"><div><span className="font-mono font-bold text-slate-500 mr-2">{formatTimeOnly(t.recordedAt)}</span><span>{t.page}p</span></div><button onClick={() => user ? deleteTimestampCloud(editingStackId || activeStackId, t.id) : deleteTimestampLocal(editingStackId || activeStackId, t.id)} className="text-slate-300 hover:text-red-500 opacity-0 group-hover:opacity-100"><Trash2 size={14} /></button></div>))}</div>
                                </div>
                            )}
                        </div>
                    </main>
                    {isStackModalOpen && (
                        <div className="fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4">
                            <div className="bg-white rounded-xl p-6 w-full max-w-sm shadow-xl">
                                <h3 className="font-bold text-lg mb-4">ìˆ˜ë™ ìŠ¤íƒ ìƒì„±</h3>
                                <div className="space-y-4 mb-6"><div><label className="block text-xs font-bold text-slate-500 mb-1">ì‹œì‘ ë‚ ì§œ</label><input type="date" className="w-full p-3 border rounded-lg" value={newStackDate} onChange={e => setNewStackDate(e.target.value)} /></div><div><label className="block text-xs font-bold text-slate-500 mb-1">ì‹œì‘ ì‹œê°</label><input type="time" className="w-full p-3 border rounded-lg text-lg" value={newStackStartTime} onChange={e => setNewStackStartTime(e.target.value)} /></div></div>
                                <button onClick={handleCreateStackManual} className="w-full py-3 bg-blue-600 text-white rounded-lg font-bold hover:bg-blue-700">ìŠ¤íƒ ìƒì„±</button><button onClick={() => setIsStackModalOpen(false)} className="w-full py-3 text-slate-400 text-sm mt-2">ì·¨ì†Œ</button>
                            </div>
                        </div>
                    )}
                </div>
            );
        }

        // Render to DOM
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
